/**
 * This is a Node.js script that generates the file at peachytools.com/sitemap.xml.
 * The sitemap.xml tells search engines about the various pages on the site.
 */

const fs = require('fs');

const THIS_FILE_NAME = __filename.slice(__dirname.length + 1);
const SITEMAP_LOCATION = __dirname + '/../../';

const SITEMAP_START = `<?xml version="1.0" encoding="UTF-8"?>
<!-- This file was generated by ${THIS_FILE_NAME}. -->
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
    <url>
        <loc>https://peachytools.com/</loc>
        <changefreq>weekly</changefreq>
        <priority>0.5</priority>
    </url>`;

const SITEMAP_END = `
</urlset>
`;

function getEnabledTools() {
    const toolsFile = fs.readFileSync(__dirname + '/../../tools.json');
    const tools = JSON.parse(toolsFile);
    return tools.filter(t => t.disabled !== true);
}

function generateSitemapContents() {
    let contents = SITEMAP_START;
    contents += getEnabledTools().map(toolToUrlXml).join('');
    return contents + SITEMAP_END;
}

function toolToUrlXml(tool) {
    return `
    <url>
        <loc>https://peachytools.com/${tool.url}</loc>
        <changefreq>weekly</changefreq>
        <priority>0.5</priority>
    </url>`;
}

function generateSitemapXml() {
    const contents = generateSitemapContents();
    fs.writeFileSync(SITEMAP_LOCATION + 'sitemap.xml', contents);
}

exports.generateSitemapXml = generateSitemapXml;
