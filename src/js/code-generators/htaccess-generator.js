/**
 * This is a Node.js script that generates the .htaccess file.
 * The .htaccess is a configuration file for Apache (web server).
 */

const fs = require('fs');

const THIS_FILE_NAME = __filename.slice(__dirname.length + 1);
const HTACCESS_LOCATION = __dirname + '/../../';

const HTACCESS_START = `# This file was generated by ${THIS_FILE_NAME}.

RewriteEngine On
RewriteRule ^about$ index.php
RewriteRule ^purpose$ index.php
`;

const HTACCESS_END = `

ErrorDocument 404 /index.php
`;

function getEnabledTools() {
    const toolsFile = fs.readFileSync(__dirname + '/../../tools.json');
    const tools = JSON.parse(toolsFile);
    return tools.filter(t => t.disabled !== true);
}

function generateHtaccessContents() {
    let contents = HTACCESS_START;
    contents += getEnabledTools().map(toolToHtaccessLine).join('');
    return contents + HTACCESS_END;
}

function toolToHtaccessLine(tool) {
    return `
RewriteRule ^${tool.url}$ index.php`;
}

function generateHtaccess() {
    const contents = generateHtaccessContents();
    fs.writeFileSync(HTACCESS_LOCATION + '.htaccess', contents);
}

exports.generateHtaccess = generateHtaccess;
